<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="utf-8">
<title>Вход в стаята</title>
<style>
  body{font-family:Arial;text-align:center;padding:40px;background:#f0f4ff;}
  input{padding:10px;margin:10px;width:220px;border-radius:6px;border:1px solid #ccc;}
  button{padding:10px 18px;background:#3399ff;color:#fff;border:none;border-radius:8px;cursor:pointer;}
</style>
</head>
<body>
  <h2>НАПИШИ КОДА ОТ СТРИЙМА ТУК</h2>
  <input id="pin" placeholder="Код (6 цифри)" maxlength="6"><br>
  <input id="username" placeholder="ЛАБКОИН ИМЕТО ТИ ТУК"><br>
  <button onclick="joinRoom()">Вход</button>

<script>
async function joinRoom(){
  const pin = document.getElementById('pin').value.trim();
  const username = document.getElementById('username').value.trim();
  if (!pin || !username){ alert('Моля въведете код и потребителско име'); return; }

  // Check room existence via API
  try {
    const res = await fetch(`/api/rooms/${pin}`);
    if (!res.ok) { alert('Стаята не съществува или е изтрита.'); return; }
  } catch (e) { alert('Грешка при свързване към сървъра.'); return; }

  // Save username & code in query and redirect to room page which will open ws
  const params = new URLSearchParams({ code: pin, username: encodeURIComponent(username) });
  window.location.href = `room.html?code=${pin}&username=${encodeURIComponent(username)}`;
}
</script>
</body>
</html>
